{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}<title>Residencial Onix | Adicionar despesas </title>{% endblock %}
      
{% block dashboard %}

<link rel="stylesheet" type="text/css" href="{% static 'css/receitas.css' %}">

<div style="height: 110px!important;" class="section-header">
    <h5 style="margin-top: -28px; color:#cccccc;" class="position-absolute ml-2 mb-4">Pessoal</h5>
    <br>
    <h1 style="color: #8898aa; font-size: 40px;" class="mt-4 ml-2">Finanças</h1>
    <div class="section-header-breadcrumb">       
        <i style="font-size: 70px; color: #000066;" class="fas  fa-server"></i>
    </div>
    </div>

    <div class="section-body">
    	<a href="{% url 'pessoal:manager' %}"><div style="cursor: pointer;" class=" pe-auto float-left icon-top text-dark voltar"  data-toggle="tooltip" data-placement="top" title="Voltar"><i class="fas fa-reply-all"></i></div> </a>
    	<br>
        <h2 class="section-title">Nova Receita</h2>
        <p class="section-lead">
          Adicionar os dados da nova despesa, todos os dados devem ser legitimo para o calculo correto na contabilidade.
        </p>
        <div class="row">
            <div class="col-12 col-md-12 col-lg-12">         
                <div class="card">
              <div class="card-header">
                <h4>Nova Receita</h4>
              </div>
              <div class="card-body">
                <div class="alert alert-danger">
                  <b>Nota!</b> Os dados devem ser verdadeiro.
                </div>
                <form action="." method="POST"  enctype="multipart/form-data" >
                {% csrf_token %}
            	<div class="row">
			        <div class="col-md-4 order-md-2 mb-4">
			          <h4 class="d-flex justify-content-between align-items-center mb-3">
			            <span class="text-muted">Resumo</span>			            
			          </h4>
			          <ul class="list-group mb-3">
			            <li class="list-group-item d-flex justify-content-between lh-condensed">
			              <div>
			                <h6 class="my-0">Categoria</h6>
			                <small class="text-muted" id="resumo-categoria"></small>
			              </div>
			              <span class="text-muted">R$ <span id="resumo-valor"></span> </span>
			            </li>
			            <li class="list-group-item d-flex justify-content-between lh-condensed">
			              <div>
			                <h6 class="my-0">Cotação</h6>
			                <small class="text-muted" id="moeda"></small>
			              </div>
			              <span class="text-muted" id="cotacao"></span>
			            </li>
			            <li class="list-group-item d-flex justify-content-between lh-condensed">
			              <div>
			                <h6 class="my-0" >Conversão</h6>
			                <small class="text-muted" id='forma'></small>
			              </div>
			              <span class="text-muted" id="conversao"></span>
			            </li>
			         
			            <li class="list-group-item d-flex justify-content-between bg-light">
			              <span>Total (<span id="total"></span>)</span>
			              <strong ><span id="valor-total"></span></strong>
			            </li>
			          </ul>			         
			        </div>
			        <div class="col-md-8 order-md-1">			      
			          <form class="needs-validation" novalidate="">
			            <div class="row">
			              <div class="col-md-5 mb-3">
			                <label for="firstName">Valor</label>
			                <input type="text" class="form-control" name="valor" id="valor" placeholder="0,00" value="" required="" onblur="calcular()">
			              </div>
			              <div class="col-md-2 mb-3">
			              		<label for="address2">Moeda</label>
			              		<select name="moeda" class="select form-control" onblur="calcular()">
			              			
			              		</select>
			            	</div>
			              <div class="col-md-5 mb-3">
			                <label for="lastName">Data</label>
			                <input type="date" class="form-control" name="data" id="lastName" placeholder="" value="" required="">
			                <div class="invalid-feedback">
			                  Valid last name is required.
			                </div>
			              </div>
			               
			            </div>
			            <div class="mb-3">
			              <label for="username">Descrição</label>
			              <div class="input-group">			            
			                <textarea style="height: 110px;" name="descricao" type="text" class="form-control" id="username" placeholder="Descrição" required="">
			                </textarea>
			                <div class="invalid-feedback" style="width: 100%;">
			                  Your username is required.
			                </div>
			              </div>
			            </div>

			            <div class="mb-3">
			              <label for="categorias">Categorias</label>
			              <select id="categorias" name="categoria" class="form-control">
			              	{% for categoria in categorias %}
			              	<option value="{{ categoria.id }}">{{ categoria.nome }}</option>
			              	{% endfor %}
			              </select>
			              <div class="invalid-feedback">
			                Please enter a valid email address for shipping updates.
			              </div>
			            </div>

			            <div class="mb-3">
			              <label for="address">Observação</label>
			              <input type="text" class="form-control" id="observacao" name="observacao" placeholder="" required="" onblur="calcular()">
			              <div class="invalid-feedback">
			                Please enter your shipping address.
			              </div>
			            </div>
			            <div class="form-group mt-5">
	                      <div class="control-label">Modelo de receitas</div>
	                      <div class="custom-switches-stacked mt-2">
	                        <label class="custom-switch">
	                          <input id="fixa" type="radio" name="option" value="1" class="custom-switch-input">
	                          <span class="custom-switch-indicator"></span>
	                          <span class="custom-switch-description">Fixa</span>
	                        </label>
	                        <label class="custom-switch">
	                          <input id="repetir" type="radio" name="option" value="2" class="custom-switch-input">
	                          <span class="custom-switch-indicator"></span>
	                          <span class="custom-switch-description">repetir</span>
	                        </label>
	                      	<div id="fixa-repetir" class="fixa-repetir">
			                   	<div class="row mt-4 ml-5">
			                    		<div class="col-md-4">
			                    		<div class="form-group">			                      
					                      <div class="input-group">
					                        <div class="input-group-prepend">
					                          <div class="input-group-text">
					                            Vezes
					                          </div>
					                        </div>
					                        <input type="text" class="form-control currency" placeholder="0">
					                      </div>
					                    </div>
			                    		</div>
			                    		<div class="col-md-4">
			                    		<div class="form-group">	                    			
					              			<select name="tempo" class="form-control">
					              				<option selected>---------</option>
					              				<option value="1" >Dias</option>
					              				<option value="7" >Semanas</option>
					              				<option value="30" >Meses</option>
					              				<option value="366" >Anos</option>
					              			</select>
			                    		</div>
			                    		</div>
			                   	</div>
		                    </div>
	                      </div>
	                    </div>			                   			            
			        </div>
			    </div>	             
                <div>
                    {% for key, value in form.errors.items %}
                    <span class="fieldWrapper">
                        <div class="alert alert-danger">
                            <b>Nota!</b> {{ key }}:{{ value }}
                          </div>
                        
                    </span>
                {% endfor %}
                </div>         
                <div class="card-footer text-left">
                <input class="btn btn-success mr-1" type="submit" value="Cadastrar" name="">
                <button class="btn btn-danger" type="reset">Cancelar</button>
                </form>
                </div>
                </div>            
            </div>            
        </div>         
    </div> 

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<script src="{% static 'js/country-list.js' %}"></script>
 <script src="{% static 'js/script.js' %}"></script>

<script type="text/javascript">
  $(document).ready(function(){
    $('input[type="text"]').each(function(){
        var val = $(this).val().replace(',','.');
        $(this).val(val);
    });
  });
</script>


<script type="text/javascript">

  function calcular() {

  const toCurrency = 'BRL'
  var fromCurrency

  var valor = parseFloat(document.getElementById('valor').value, 10);
  var observacao = document.getElementById('observacao');
  var categoria = document.getElementById('categorias').value;
  var resume = document.getElementById('resumo-categoria');
  var vt = document.getElementById('resumo-valor');
  var moeda = document.getElementById('moeda');
  var cotacao = document.getElementById('cotacao');
  var forma = document.getElementById('forma');
  var conversao = document.getElementById('conversao');
  var total = document.getElementById('total');
  var valor_total = document.getElementById('valor-total');


  fromCurrency = document.querySelector(".select").value;




  if(fromCurrency == toCurrency){

	observacao.value = `${'R$'} ${valor}`;
	resume.innerHTML = categoria;
	vt.innerHTML = `${'R$'} ${valor}`;
	moeda.innerHTML = toCurrency;
	cotacao.innerHTML = `${'R$'} ${valor}`;
	forma.innerHTML = "O valor é na mesma moeda";
	conversao.innerHTML = 0;
	total.innerHTML = toCurrency;
	valor_total.innerHTML = `${'R$'} ${valor}`;



  }else{

  	let url = `https://v6.exchangerate-api.com/v6/f98031f8ef206b0ae84d79df/latest/${fromCurrency}`;
  	 // fetching api response and returning it with parsing into js obj and in another then method receiving that obj
    fetch(url).then(response => response.json()).then(result =>{
        let exchangeRate = result.conversion_rates[toCurrency]; // getting user selected TO currency rate
        let totalExRate = (valor * exchangeRate).toFixed(2); // multiplying user entered value with selected TO currency rate
        observacao.value = `${valor} ${fromCurrency} = ${totalExRate} ${toCurrency}`;
    }).catch(() =>{ // if user is offline or any other error occured while fetching data then catch function will run
        observacao.innerText = "algo deu errado";
    });


  	} 
  }
</script>

<script type="text/javascript">

let fixa = document.querySelector("#fixa");
let repetir = document.querySelector("#repetir");
var start = document.getElementById("fixa-repetir");



fixa.addEventListener('click', ()=>{

if($('#fixa').css('display') === 'none')

		{
		    start.style.display = 'block'
		    start.style.display = 'none'

		}
		else
		{
		    start.style.display = 'none'

		}


})


repetir.addEventListener('click', ()=>{


		if($('#fixa-repetir').css('display') === 'none')
		{
		    start.style.display = 'block'
		    fixa.style.display = 'none'

		}
		else
		{
		    start.style.display = 'none'

		}

	
})
</script>

{% endblock %}
